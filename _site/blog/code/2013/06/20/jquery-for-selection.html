<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>使用JQuery实现选择文本弹出Popover</title>
   <meta name="author" content="buxiangshuo" />
   <meta name="keywords" content="互联网,设计师,产品设计,移动开发,交互设计,心理学爱好者,敏捷开发,用户体验,情感化,Ruby on Rails,PHP,文字控,爱音乐,爱旅游" />
   <meta name="description" content="互联网产品设计爱好者,交互设计爱好者,喜欢多角度思考问题,崇尚敏捷开发与情感化设计,注重团队建设,勉强及格的爱人和朋友" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/css/screen.css" type="text/css" media="screen, projection" />
   <link href="/assets/css/syntax.css" type="text/css" rel="stylesheet" />
   <link rel="shortcut icon" href="/favicon.ico" />

</head>
<body>

<div class="site">
  <div class="title">
    <a href="/"><img src="/assets/img/logo.png" style="margin-bottom: -5px;"/></a>
    <a class="extra" href="/">Home</a>
	<a class="extra" href="/feeling.html">Feeling</a>
	<a class="extra" href="/think.html">Think</a>
	<a class="extra" href="/code.html">Code</a>
	<a class="extra" href="/design.html">Design</a>
    <a class="extra" href="/read.html">Read</a>
  <!--<a class="extra" href="/resume/index.html">Resume</a>-->
  </div>

  <div id="post">
  <h1>使用JQuery实现选择文本弹出Popover</h1>

<p class="meta">20 六月 2013</p>

<p>这两天看了 <a href="http://medium.com">Medium</a> 的Note功能，感觉非常棒，不是单纯的针对整篇文章进行评论，从而更加具有针对性，虽然有一定的缺点，但是也不失为一种解决方案，日后有机会可以在此基础上微创新一下，或综合一下。</p>

<p>但这不是这篇文章的重点，从技术角度来讲，我不熟悉JS，只会简单用用Jquery，所以就用它做了一个那个效果的模仿，虽然解决方案很简陋，但是有点效果，过几天用Rails写个站试试，用作comment的前端方案。</p>

<p>除了Jquery，还使用了以下东西：</p>

<p>Popover的选择：<a href="http://todc.github.io/todc-bootstrap">Todc-Bootstrap</a> 这是仿照Google风格的bootstrap版本，非常好用，界面也不错，这里使用popover</p>

<p>Selection的库：<a href="http://jquerypp.com/#range">JQuery++</a> 是对jquery的补充的一个插件集，可以针对自己的需要下载相应功能的插件，我这里使用的是range插件</p>

<p>高亮的插件：<a href="http://johannburkard.de/blog/programming/javascript/highlight-javascript-text-higlighting-jquery-plugin.html">Highlight</a> 很简单的需求，直接用插件解决得了</p>

<p><img src="/assets/img/4.png" alt="效果图"></p>

<p>代码中有详细注释：</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#text&#39;</span><span class="p">).</span><span class="nx">mouseup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">.</span><span class="nx">current</span><span class="p">();</span>  <span class="c1">//获取selection对象</span>
    <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">start</span><span class="p">().</span><span class="nx">offset</span><span class="p">,</span>  <span class="c1">//文本起始位置</span>
        <span class="nx">end</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">end</span><span class="p">().</span><span class="nx">offset</span><span class="p">,</span>  <span class="c1">//结束位置</span>
        <span class="nx">ranger</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>   <span class="c1">//selection字符串</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>   <span class="c1">//排除光标点击一下的情况</span>

            <span class="c1">//替换文本为加入tag的样式，从而使用popover</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;div:contains(&#39;&quot;</span> <span class="o">+</span> <span class="nx">ranger</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">newText</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">html</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="nx">ranger</span><span class="p">,</span> 
                    <span class="s2">&quot;&lt;span class=&#39;item&#39; rel=&#39;popover&#39; data-placement=&#39;top&#39;&gt;&quot;</span> 
                        <span class="o">+</span> <span class="nx">ranger</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">newText</span><span class="p">);</span>
                <span class="p">});</span>


                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#status&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;起始位置 = &quot;</span> <span class="o">+</span> <span class="nx">start</span>
                        <span class="o">+</span> <span class="s2">&quot;&lt;br /&gt;结束位置 = &quot;</span> <span class="o">+</span> <span class="nx">end</span>
                        <span class="o">+</span> <span class="s2">&quot;&lt;br /&gt;已选择文本 = &quot;</span> <span class="o">+</span> <span class="nx">ranger</span>
                <span class="p">);</span>

                <span class="c1">//Bootstrap的popover的content做自定义返回内容</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.item&#39;</span><span class="p">).</span><span class="nx">popover</span><span class="p">({</span> 
                    <span class="nx">html</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nx">content</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#popover_content_wrapper&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">});</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.item&#39;</span><span class="p">).</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.item&#39;</span><span class="p">).</span><span class="nx">highlight</span><span class="p">(</span><span class="nx">ranger</span><span class="p">);</span>  <span class="c1">//高亮添加了tag的文本，即选中文本</span>
            <span class="p">};</span>
        <span class="p">});</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.item&#39;</span><span class="p">).</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">);</span>  <span class="c1">//鼠标落下事件隐藏popover</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">).</span><span class="nx">contents</span><span class="p">().</span><span class="nx">unwrap</span><span class="p">();</span>  <span class="c1">//去除选择文本的tag</span>
        <span class="p">});</span>
</code></pre></div>
  <p></p>
  <div id="related">
    <h3>最近文章</h3>
    <ul class="posts">
    
      <li><span>22 Mar 2014</span> &nbsp;&raquo;&nbsp; <a href="/think/2014/03/22/ios7-design-tips.html">《IOS7人机交互设计准则》笔记</a></li>
    
      <li><span>02 Feb 2014</span> &nbsp;&raquo;&nbsp; <a href="/think/2014/02/02/Activity-Centered-Design.html">以人为中心的设计可能是有害的（Don Norman）</a></li>
    
      <li><span>18 Dec 2013</span> &nbsp;&raquo;&nbsp; <a href="/think/2013/12/18/the-data-analysis-report.html">产品经理如何写好一份数据分析报告（转）</a></li>
    
    </ul>
  </div>

  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'wuyanyu'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	
	<a href="/" class="tohome">主页</a>
	<a href="#" class="totop">顶部</a>
</div>




  <div class="footer">
    <div class="contact">
      <p>
        Built based on <a href="https://github.com/mojombo/jekyll/">Jekyll</a><br />
        Theme based on <a href="http://tom.preston-werner.com/">Tom</a><br />
        Hosting on <a href="http://page.github.com/">GitHub Page</a><br />
        Thanks for <a href="https://github.com/mojombo/">Mojombo</a>
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="http://github.com/buxiangshuo/">Github</a><br />
        <a href="http://weibo.com/moshuohua/">微博</a><br />
        <a href="http://www.douban.com/people/47516504/">豆瓣</a><br />
        <a href="mailto:moshuohua@gmail.com">Gmail</a>
      </p>
    </div>
  </div>
</div>

<!-- disqus comment count -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'wuyanyu'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

<!-- baidu script -->

<script type="text/javascript">
   var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
   document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F6b94dd9b0c69ce6e1bea7a33a4f2dc5d' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- google script -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30271188-2', 'wuyanyu.com');
  ga('send', 'pageview');

</script>

</body>
</html>
